---
title: 第二章 关系数据库
date: 2019-08-13 21:11:16
categories: 幽邃研路
tags: [考研,人大855,数据库]
---
### 关系数据结构即形式化定义
#### 关系
关系模型的数据结构只包含单一的数据结构---关系。从用户角度，模型中数据的逻辑结构就是一张二维表  
###### 关系模型的形式化定义  
1. **域**：域是一组具有相同类型的数据值的集合  
2. **笛卡儿积**：笛卡儿积是域上的一种集合运算。（运算结果是**n元组**，简称**元组**，元组中的每一个值叫做**分量**）  
3. **基数**：一个域所允许的不同取值个数（定义域内元素个数）  
<!--more--> 
4. 关系：笛卡儿积的子集叫做在域上的关系(这个子集和下边的子集不一样，这里的子集仅仅是元组上的子集，属性不可缺失)，域的数量n表示关系的**目**或**度**。n=1时，称该关系为**单元关系**，n=2时，称该关系为**二元关系**  
5. 候选码：若关系中某一属性组的值能够唯一标识一个元组，而其子集不能。
6. 若一个关系有多个候选码，则选定其中一个为主码  
7. 候选码中的所有属性称为**主属性**。不包含在任何候选码中的属性称为**非主属性**或者**非码属性**  
8. **全码**：关系模式的所有属性都是这个关系模式的候选码

###### 关系的类型
- 基本关系
    - 这是实际存在的表，他是实际存储数据的逻辑表示
- 查询表
    - 查询结果对应的表
- 视图表
    - 是由基本表或者其他视图表导出的表，是虚标，不对应实际存储的数据

###### 基本关系的6条性质
1. 列是同质的
    - 每一列中的每辆是同一类型的数据，来自于同一个域
2. 不同的列可出自同一个域，称其中的每一列为一个属性，不同的属性要给予不同的属性名
3. 列的次序可以任意交换
4. 任意两个元组的候选码不能取相同的值
5. 行的顺序无所谓
6. 分量必须取原子值
    - 每一个分量都必须是不可分的数据项

关系模型要求关系必须是规范化的，即要求关系必须满足一定的规范条件，这些规范条件中最基本一条就是：**关系的每一个分量必须是一个不可分的数据项**   

#### 关系模式 
关系模式是对于关系的描述，模式是型，关系是值，模式是静态的，关系是在不断动态变化的。关系从属于关系模式。  
关系模式描述内容：它由那些属性组成，这些属性来自那些域，以及属性和域之间的影响关系，关系的完整性约束条件  

###### 定义
关系的描述称为关系模式，他可以形式化地表述为：R(U,D,DOM,F)  
R--关系名；U--属性名集合；D--U中的属性来源的域；DOM--属性向域的映像集合；F--属性间数据的依赖关系集合  

关系模式通常简记为R(U)，而域名以及属性向域的映像常常直接说明为属性的类型、长度  

关系模式是静态的、稳定的，而关系是动态的，随时间不断变化的  

#### 关系数据库
在关系模型中，实体以及实体间的联系都是用关系来表示的。在一个给定的应用领域中，所有关系的集合构成一个关系数据库  

**关系数据库的型也称为关系数据库模式，是对关系数据库的描述**。关系数据库模式包含若干域的定义，以及在这些域上定义的若干关系模式  
关系数据库的值是这些关系模式在某一时刻对应的关系的集合，通常称为关系数据库  

#### 关系模型的存储结构
在关系模型中，实体和实体间的联系都用表来表示，但表示关系数据的逻辑模型  


### 关系操作
关系模型给出了关系操作的能力的说明，但是并没有具体的语法要求  
#### 基本的关系操作
查询以及增删改  

**查询的基本操作：选择、投影、并、交、笛卡儿积**  

关系操作的特点：
**关系操作是集合操作方式，即操作的对象和结果都是集合**  

#### 关系数据语言的分类
```
graph LR
关系操作能力的表达-->关系代数
关系操作能力的表达-->关系演算
关系代数
关系演算-->元组关系演算
关系演算-->域关系演算
```
关系代数和关系演算体现关系的操作能力，他们并不是实际的查询语言，而是用于评估数据库内关系数据语言能力的标准和基础  
一个关系数据语言能够表示关系代数可以标识的查询，称为具有完备的查询能力  

由此，就发展出了关系代数语言、域关系演算语言以及元组关系演算语言  

结构化查询语言（SQL）
集查询、数据定义语言、数据操纵语言和数据控制语言于一体的关系数据语言  

```
graph TD
关系数据语言-->关系代数语言
关系代数语言-->例如ISBL
关系数据语言-->关系演算语言
关系数据语言-->具有关系代数和关系演算双重特点的语言
具有关系代数和关系演算双重特点的语言-->例如SQL
关系演算语言-->元组关系演算语言
元组关系演算语言-->例如ALPHA\QUEL
关系演算语言-->域关系演算语言
域关系演算语言-->例如QBE
```

### 关系的完整性
关系模型的完整性规则是对关系的某种约束条件。  
关系模型中有三类完整性约束：**实体完整性，参照完整性、用户定义的完整性**  
实体完整性和参照完整性是关系模型必须满足的完整性约束条件，被称作是**关系的两个不变性**  
用户定义的完整性体现具体领域的语义约束  
#### 实体完整性
**实体完整性规则：若属性（指一个或一组属性）A是基本关系R的主属性，则A不能取空值。所谓空值就是”不知道“或“不存在”或“无意义”的值**  

实体完整性保证：关系数据库中每个远足应该是可区分的，是唯一的。  

###### 说明
1. 实体完整性规则是针对于基本关系而言的。一个基本表通常对应现实世界的一个实体集  
2. 现实世界的实体是可区分的，即他们都具有某种唯一性标识  
3. 关系模型中，为表达这个约束，采用主码作为唯一性表示
4. 主码属性不可空，空值说明存在某不可区分的的实体   

#### 参照完整性

外码：
设F是基本关系R的一个或一组属性，但不是关系R的码，K是基本关系S的主码，如果F和K对应，则称F是R的外码，并称基本关系R为参照关系，基本关系S为被参照关系或者目标关系。
（S和F可以是同一个关系）  

参照完整性规则定义的就是外码和主码之间的引用规则  

**参照完整性规则：若属性（或属性组）F是基本关系R的外码，它于基本关系S的主码K相对应，则对于R中的每一个元组在F上的值必须**：
- **或者取空值（F中的每个属性都取空值）**
- **或者等于S中某个元组的主码值**

#### 用户定义的完整性


### 关系代数
关系代数**用对关系的运算来表达查询**  

关系代数的运算符分为：集合运算符和专门的关系运算符  
根据运算符的不同，关系代数的运算可分为**传统的集合运算和专门的关系运算两类**  
传统的集合运算将关系看作是行的集合，而专门的关系运算既涉及行，又涉及列   

#### 传统的集合运算
**传统的集合运算是二目运算，包括并、差、交、笛卡儿积这四种运算**  

#### 专门的关系运算
**专门的关系运算包括选择、投影、连接、除运算等**

引入术语：
1. 元组的连接/元组的串接：n列元组和m列元组连接后就是n+m列元组  
2. 象集：设一个关系为R(X,Z)，当t[X]=x时，对应的t[Z]的取值集合。（R中属性组X上值为x的诸元组在Z上分量的集合  

##### 选择
1. 符号表示

$$\sigma _{F}(R)=\left \{ t|t\in R\wedge F(t)=true \right \}$$

2. 含义：从关系R中选区使逻辑表达式F为真的元组，这是从行的角度进行的运算  
（逻辑表达式F的基本形式为：XθY，其中，θ表示比较运算符，X、Y可以是属性名，或者是常量，或者简单函数。在基本的选择条件上还可以进一步进行逻辑运算，如与或非）  
3. 在书写关系代数时的书写方法  
```math
\sigma _{F}(R)
```
F处填写限制条件，R处填写关系名（表名）  

##### 投影
1. 符号表示
```math
\Pi _{A}(R)=\left \{ t[A] |t\in R \right \}
```
2. 含义  
关系R上的投影是从R中选择出若干属性列组成新的关系  
（投影后出现的重复行会被合并）  
3. 书写方法
A出填写行名，R处填写表名  
```math
\Pi _{A}(R)
```

##### 连接
1. 符号表示（懒得打了以后补上）

2. 含义  
连接运算从R和S的笛卡儿积RxS中选区R关系在A属性组上的值于S关系在B属性组上的值满足比较关系θ的元组  

3. 分类
    - 等值连接
    - 自然连接

4. 等值连接：θ为“=”的连接运算称为等值连接  
5. 自然连接：
    - 概念：自然链接是一类特殊的等值连接，他要求两个关系中进行比较的分量必须是同名的属性组，并且在结果中把重复的属性列去掉  
    - 悬浮元组：在S或者R中被舍弃的元组
    - 外连接：将悬浮元组也保留在结果关系总，而在其他属性上填空值
        - 左外连接：只保留左边关系R中的悬浮元组
        - 右外连接：同理

6. 书写方法
```math
R\bowtie S --> natural\ join 
```
```math
R\bowtie_{A\theta B} S --> join
```

##### 除运算
1. 符号表示  
```math
R\div S=\left \{ t_{r}\left [ X \right ]|t_{r}\in R\wedge \Pi _{Y}(S)\subseteq Y_{x} \right \}
```
其中Yx为x在R中的象集
2. 概念
设关系R除以关系S的结果为关系T，则**T包含所有在R但不在S中的属性及其值，且T的元组与S的元祖的所有组合都在R中**  

**并、差、笛卡儿积、选择和投影这五种运算时基本的运算**  
**在关系代数中，这些运算经有限次复合后形成的表达式称为关系代数表达式**  
