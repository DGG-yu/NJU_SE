---
title: Unit3 关系数据库标准语言SQL(前三节)
date: 2019-08-15 17:18:30
categories: 幽邃研路
tags: [考研,人大855,数据库]
---
### SQL概述
#### SQL的产生与发展
1. 目前，没有一个数据库系统能够支持SQL标准的所有概念和特性  
2. 同时，许多厂商对于SQL基本命令集进行了不同程度的扩充和修改，又可以支持标准以外的一些功能特性  
<!--more--> 
#### SQL的特点
1. 综合统一  
    - 非关系模型的数据语言一般分为四种，在数据库投入运行之后，如果想修改模式需要重装数据库。SQL集四种语言功能于一体。用户修改模式不需要数据库停止运行  
    - 数据结构的单一性带来了数据操作符的单一性，克服了非关系系统由于信息表示方式的多样性带来的操作复杂性
2. 高度非过程化
    - 用SQL进行数据操作时，只要提出做什么，而无须指明怎么做，因此无需了解存取路径。存取路径的选择以及SQL的操作过程由系统自动完成  
3. 面向集合的操作方式
4. 以同一种语法结构提供多种使用方式
    - SQL既是独立的语言，又是嵌入式语言。可以嵌入进高级语言程序中，而在两种不同的使用方式下，SQL的语法结构基本是一致的
5. 语言简洁、易学易用

#### SQL的基本概念
1. 基本表是独立存在的表，在DBMS中一个关系对应一个基本表，一个or多个基本表对应一个存储文件，一个表可以带若干索引，索引也存放在存储文件中
2. 存储文件的逻辑结构构成了关系数据库的内模式。存储文件的物理结构对最终用户是隐蔽的
3. 视图是从一个或几个基本表导出的表，它本身不独立存储与数据库中。它里面的数据存放在导出视图的基本表中  视图之上可以继续定义视图

### 学生-课程数据库
本章所用的样例为学生课程数据库  

### 数据定义
关系数据库系统支持三级模式结构，其模式、外模式、内模式的基本对象有模式、视图、表、索引等，因此SQL的数据定义功能包括模式定义、视图定义、表定义、索引定义  

操作对象 | 创建 | 删除 | 修改 
---|---|---|---
模式 | CREATE SCHEMA | DROP SCHEMA | 
表 | CREATE TABLE | DROP TABLE | ALTER TABLE
视图 | CREATE VIEW | DROP VIEW | 
索引 | CREATE INDEX | DROP INDEX | ALTER INDEX

想要对于模式或者视图进行修改，就只能删了重建  

在早期数据库系统中，所有数据库对象都属于一个数据库。在现在，**一个关系DBMS的实例中可以建立东哥数据库，一个数据库中可以建立多个模式，一个模式下通常包括多个表、视图和索引等数据库对象**  

#### 模式的定义和删除
##### 定义模式
###### 定义语句：  
CREATE SCHEMA <模式名> AUTHORIZATION <用户名>  
（如果没有指明模式名，则模式名隐含为用户名）  
###### 意义：
定义模式实际上定义了一个命名空间，在这个空间中可以进一步定义该模式包含的数据对象（如基本表、视图、索引等）  

目前，在定义模式的时候，可以直接在模式定义中进一步创建视图、基本表或进行授权。完整语句如下  
**CREATE SCHEMA <模式名> AUCHORIZATION <用户名> [<表定义子句>|<视图定义子句>|<授权定义子句>]**  
（“[]”与“|”并不是子句中真实存在的，这里是为了更好理解）  

举个例子：  
为用户ZANG创建一模式，并直接定义个表：  
CREATE SCHEMA TEST AUCHORIZATION ZANG 
CREATE TABLE TAB1 (COL1 LALA
                   COL2 BALA);

##### 删除模式
###### 删除语句：
DROP SCHEMA <模式名> <CASCADE|RESTRICT>；
###### 参数说明：
1. CASCADE（级联）：  
表示在删除模式的同时把该模式下所有的数据库对象全部删除
2. RESTRICT（限制）：  
如果在该模式中已经定义了数据库对象，则拒绝删除语句的执行  

#### 基本表的定义、删除与修改
##### 定义基本表
创建一个模式，就建立了一个数据库的命名空间。在这个空间中首先要定义的是该模式包含的数据库基本表  
###### 定义语句：  
CREATE TABLE <表名> (<列名><数据类型>[列级完整性约束条件],
                     <列名><数据类型>[列级完整性约束条件])
                     <列名><数据类型>[列级完整性约束条件]
                     ……
                     [<表级完整性约束条件>]);  

注意：  
- 这些完整性约束条件写入系统的数据字典中，由系统自动检查
- 如果完整性约束条件涉及该表的多个属性列，则必须定义在表级上  
- 定义外码时，**参照表和被参照表可以是同一张表**  
##### 数据类型
在SQL中域的概念用数据类型来实现，定义表的各属性时要知名其数据类型及长度  

数据类型 | 含义
---|---
CHAR(n) | 长度为n的定长字符串
VARCHAR(n) | 最大长度为n的变长字符串
CLOB | 字符串大对象
BLOB | 二进制大对象
INT, INTEGER | 长整数（4B）
SMALLINT | 短整数
BIGINT | 大整数
NUMERIC(p,d) | 定点数，由p位数字（不包括符号或小数点）组成，小数点后有d位数字
REAL | 单精度浮点数
DOUBLE PRECISION | 双精度浮点数
FLOAT(n) | 可选精度的浮点数，精度至少为n位
BOOLEAN | 逻辑布尔量
DATE | 日期，格式为 YYYY-MM-DD
TIME | 时间，格式为HH:MM:SS
TIMESTAMP | 时间戳类型
INTERVAL | 时间间隔类型

##### 模式与表
每个基本表都属于某一个模式  
###### 定义基本表所属的模式的方法：
1. 在表名中显式给出模式名：  
CREATE TABLE "MODEL1".TAB1(...)  
2. 在创建模式语句中同时创建表
3. 设置所属模式，这样在创建表时，表名中不必给出模式名  
###### 数据库对象默认模式：
当用户创建基本表时，若没有指定模式，系统会根据搜索路径来确定该对象所属的模式。搜索路径包含一组模式列表，DBMS会使用模式列表中第一个存在的模式作为数据库对象的模式名，模式名都不存在就报错  

显示搜索路径：  
SHOW search_path;  
（当前没进行过操作，搜索路径的默认值是$user, PUBLIC。含义是首先搜索与用户名相同的模式名，没搜到，就使用PUBLIC模式）  

设置搜索路径：  
SET search_path TO "S-T",PUBLIC;  
然后定义基本表：CREATE TABLE TAB1();  
创建的就是"S-T".TAB1  
(搜索路径应该对应的是一个用于查询列表，用的时候对应一个模式索引)  

##### 修改基本表
###### 修改语句：  
ALTER TABLE <表名>  
[ADD [COLUMN] <新列名> <数据类型> [完整性约束]]  
[ADD [表级完整性约束]]  
[DROP [COLUMN] <列名> [CASCADE|RESTRICT]]  
[DROP CONSTRAINT<完整性约束名>[RESTRICT|CASCADE]]  
[ALTER COLUMN<列名> <数据类型>];  
说明：  
- DROP COLUMN子句：
    - CASCADE：自动删除引用了该列的其他对象
    - RESTRICT：如果该列被其他对象引用，就拒绝删除该列
- ADD COLUMN可以用于增加新的列级完整性约束条件
- ALTER COLUMN：可以修改列明或数据类型

##### 删除基本表
###### 删除语句：  
DROP TABLE <表名> [CASCADE|RESTRICT];  
说明：  
- RESTRICT：与删除的表不能倍其他约束所引用，不能有视图，不能有触发器，不能有存储过程或函数等。（靠具体厂商的实现）
- CASCADE：相关的依赖对象一起被删除
- 默认为RESTRICT

#### 索引的建立和删除
表的数据量较大时，建立索引是加快查询速度的有效手段，用户可根据需要建立一个或多个索引，以提供多种存取路径。  
###### 索引类型
- 顺序文件上的索引：  
针对按制定属性值升/降序存储的关系，在该属性上建立一个索引文件，索引文件由属性值和相应的元组指针构成  
- B+树索引：  
将索引属性组织成B+树的形式，叶节点为属性值和相应的指针  
- 散列索引
- 位图索引

**用户不必也不能显式的选择索引**  

##### 建立索引
###### 建立语句：
CREATE [UNIQUE] [CLUSTER] INDEX <索引名>  
ON <表名>(<列名> [<次序>], <列名> [<次序>],...);  

说明：  
- 次序：指定索引值的排列顺序，可选ASC DESC，默认值为ASC  
- UNIQUE：每个索引值只对应唯一的数据记录
- CLUSTER：要建立的索引是聚簇索引  

例子：  
CREATE UNIQUE INDEX stusno ON student(Sno ASC, Cno DESC);  

##### 修改索引
###### 修改语句：
ALTER INDEX <旧索引名> RENAME TO <新索引名>;  
只能重命名……  

##### 删除索引
索引一经建立就由系统使用和维护，不需用户干预。但若数据增删改频繁，系统要花费很多时间维护索引，降低查询效率，此时可以删除一些不必要的索引  
###### 删除语句：
DROP INDEX <索引名>;  

#### 数据字典
数据字典是关系DBMS内部的一组系统表，它记录了数据库中所有的定义信息，包括关系模式定义、视图定义、索引定义、完整性约束定义各类用户的操作权限，统计信息等  