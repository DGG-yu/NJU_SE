---
title:第四单元 数据库的安全性
date: 2019-08-25 11:21:45
categories: 幽邃研路
tags: [考研,人大855,数据库]
---
DBMS会提供统一的数据保护功能来保证数据的安全可靠和正式有效  
数据保护：安全性  完整性   
### 4.1 数据库安全性概述 
**数据的安全性**： 保护数据库以防止不合法使用所造成的数据泄露、更改和破坏  
#### 4.1.1 数据库的不安全因素  
对数据库安全性造成威胁的因素有如下几方面：   
##### 1. 非授权用户对数据库的恶意存取和破坏
- 用户身份鉴别、存取控制、视图等技术
##### 2. 数据库中重要或敏感的数据被泄露
- 强制存储控制、数据加密存储和加密传输等，对安全性要求较高的部门提供审计功能
##### 3. 安全环境的脆弱性
<!--more--> 
#### 4.1.2 安全标准介绍
1. CC标准（通用准则项目）  
2001年被我国采用为国家标准  
2. TCSEC标准
- TCSEC又称桔皮书  
- 而后TCSEC/TDI又称紫皮书，他将TCSEC拓展到数据库管理系统  

TCSEC/TDI中定义了DBMS设计与实现中需满足和用以进行安全性级别评估的标准，**从四个方面来描述安全性级别划分的指标：**    
- **安全策略**
- **责任**
- **保证**
- **文档**

##### TCSEC/TDI安全级别划分

安全级别 | 定义
---|---
A1 | 设计验证
B3 | 安全域
B2 | 结构化保护
B1 | 标记安全保护
C2 | 受控的存取保护
C1 | 自主安全保护
D | 最小保护
（这个划分是按照**计算机系统**对各项指标的支持情况  

##### 对各个安全级别的说明
D级：存在的意义就是将所有达不到更高级安全的系统，划入D级   
C1级：该级别非常初级。能够实现用户和数据的分离，进行**自主存取控制**，保护或限制用户权限的传播  
C2级：本级使安全产品的最低档  
B1级：提供标记安全保护，对系统的数据加以标记。并对标记的主体和客体实施强制存取控制(MAC)以及审计等安全机制。B1级别的产品才被认为是真正意义上的安全产品    

##### CC详细介绍
将安全要求分为：  
- 安全功能要求
    - 规范产品和系统的安全行为
- 安全保证要求
    - 解决如何正确有效的实施这些功能

CC的文本：  
- 简介和一般模型
- 安全功能要求
- 安全保证要求

根据系统对于安全保证要求的支持情况提出了评估保证级：  

评估保证级 | 定义 | TESCE安全级别（近似）
---|---|---
EAL1 | 功能测试 | 
**EAL2** | 结构测试 | C1
**EAL3** | 系统地测试和检查 | C2
EAL4 | 系统的设计、测试和复查 | B1
EAL5 | 半形式化测试和测试 | B2
EAL6 | 版形式化验证的设计和测试 | B3
**EAL7** | 形式化验证的设计和测试 | A1 

保护轮廓和安全目标是对于之前所说的三部分的结合与概念上的应用或框架  
（就是杠才讲了一堆概念与评估准则，但是只有概念与评估准则无法直接应用于显示的应用之上，保护轮廓与安全目标给出了一个框架，使得我们可以将上述几部分结合起来，构建出一个安全模型）  

**粗略而言，TCSEC的C1和C2级分别相当与EAL2和EAL3，B1、B2和B3分别相当于EAL4、EAL5和EAL6，A1对应于EAL7**  

### 4.2 数据库安全性控制
#### 4.2.1 用户身份鉴别
概念：系统提供一定的方式让用户标识自己的名字或身份。每次用户要求进入系统时，由系统进行核对，通过鉴定后才提供使用DBMS的权限  
这是DBMS提供的最外层保护措施  
用户身份鉴别有以下方法：  
##### 1. 静态口令鉴别
- 这是当前最常用的鉴别方法
- （就是用户名密码登陆）
- 特点：方法简单，容易被攻击，安全性较低
- 因此，DBMS会通过从口令的复杂度，口令的管理、存储及传输等多方面来保障口令的安全可靠  
##### 2. 动态口令鉴别
- 它是目前较为安全的鉴别方式
- 这种方式的口令是动态变化的，每次鉴别时君须使用动态产生的新口令登陆DBMS，即采用一次一密的方法  
- 特点：与静态口令鉴别相比，这种方式增加了口令被窃取或破解的难度，安全性相对要高一些  
##### 3. 生物特征鉴别
- 这种方式通过采用图像识别和模式识别等技术实现了基于生物特征的认证，与传统的口令鉴别相比，安全性较高  
##### 4. 智能卡鉴别 
- 实际应用中一般采用个人身份识别码和智能卡相结合的方式，从而减小安全隐患  

#### 4.2.2 存取控制
目标：确保只授权给有资格的用户访问数据库的权限。同时令所有未被授权的人员无法接近数据。  
内容：**存取控制机制主要包括定义用户权限和合法权限检查两部分**  
1. 定义用户权限,并将用户权限登记进数据字典中
    - 存储在数据字典中对于用户权限的定义被称为安全规则或授权规则
    - 每个用户应该具有何种权限不是我们所考虑的问题
2. 合法权限检查
    - 每当用户提出存取数据库的操作请求之后，DBMS差找数据字典，根据安全规则进行合法权限检查  

**定义用户权限和合法权限检查机制一起组成了DBMS的存取控制子系统**  

**C2级的DBMS支持自主存取控制(DAC)，B1级的DBMS支持强制存取控制(MAC)**    
（也就是说，存取控制的内容：定义用户权限和合法权限检查，而分类则分为：自主存取控制和强制存取控制）  

#### 4.2.3 自主存取控制
简单定义：用户对于不同的数据库对象有不同的存取权限，而不同用户对于同一数据库对象也有不同的权限，而且用户可以将自己所拥有的存取转授给其他用户，因此自主存取控制非常灵活  

SQL标准也对于自主存取控制通过REVOKE语句和GRANT语句进行了支持

**用户权限由两个要素组成：数据库对象和操作类型**  
定义一个用户的存取权限就是定义该用户可以在那些对象上执行什么操作  
**授权：定义存取权限**  

不同系统用户权限的不同：  
1. 非关系数据库系统：用户只能对数据进行操作，存取控制的数据库对象也仅限于数据本身  
2. 关系数据库系统：**存取控制的数据库对象不仅有数据本身（基本表中给的数据、属性列上的数据），还有数据库模式（包括数据库，基本表，视图和索引的创建等）**  

#### 4.2.4 授权：授予和收回
在SQL中，GRANT用于授予权限，REVOKE用于收回权限  
##### 1. GRANT语句
###### 语法格式
GRANT <权限> [,<权限>]...  
ON <对象类型><对象名>[,<对象类型><对象名>]...  
TO<用户>[,<用户>]...  
[WITH GRANT OPTION]  
###### 语句说明：  
- 发出该语句的对象可以为数据库管理员，数据库创建者，拥有该权限的用户  
- 接受权限的用户可以为一个或多个具体用户，也可以是PUBLIC，即全体用户  
- 如果指定了WITH GRANT OPTION，则获得权限的用户可以将权限传播给其他用户  
SQL中不允许**循环授权**，即被授权者不能把权限授回其祖先  

例子：
1. 对属性列授权  
```
GRANT SELECT, UPDATE(Sno)  
ON Student
TO User1,User2
WITH GRANT OPTION
```

##### 2. REVOKE
###### 语句格式：
REVOKE <权限> [,<权限>]...  
ON <对象类型><对象名>[,<对象类型><对象名>]...  
FROM<用户>[,<用户>]...[CASCADE|RESTRICT]  

说明：  
- CASCADE级联：指将用户权限连锁收回，它赋予其他用户的权限也会被收回
- RESTRICT：如果被收回的用户将权限授予了其他用户，则权限回收失败
- 不过如果用户还从其他用户获得了同样的一个权限，那么这个权限被收回，另一个权限还会存在  

数据库管理员对于数据库中的所有数据库对象拥有全部权限，永辉对于自己所建立的基本表和视图拥有全部权限并可进行授予  

**由以上，可发现，用户可以自主的决定将数据的存取权限授予何人、决定是否也将授权的权限授予别人。因此称这样的存取控制是自主存取控制**  

##### 3.创建数据库模式的权限
GRANT和REVOKE语句向用户授予或收回对**数据**的操纵权限，而对于**数据库模式**的操作权限则有数据库管理员在创建用户时实现  
###### 语句格式：
CREATE USER <username> [WITH][DBA|RESOURCE|CONNECT]  
###### 语句说明
- 只有系统的超级用户才有权创建一个新的数据库用户
- 新创建的数据库用户拥有三种权限：CONNECT、RESOURCE、DBA。  
- 若语句中没有指定权限，默认为CONNECT权限，这个权限只能登陆数据库，若被授予权限则进行权限内操作
- RESOURCE权限可以创建基本表和视图，并成为其属主，使用GRANT语句将对象的操作权限授予其他用户
- DBA权限是系统的超级用户

下方表格用于说明不同用户的权限：  

header 1 | header 2
---|---
row 1 col 1 | row 1 col 2
row 2 col 1 | row 2 col 2

**注意：CREATE USER语句不是SQL的标准语句，不同数据库管理系统的语法和内容相差甚远**  

#### 4.2.5 数据库角色
**数据库角色是被命名的一组与数据库操作相关的权限，角色是权限的集合**  
~~（角色和权限的关系类似于视图和查询语句的关系，但是也不太像，这句话先划掉吧）~~  
角色的使用方法如下：  
##### 1. 角色的创建
```
CREATE ROLE <角色名>  
```
##### 2. 给角色授权
```
GRANT <权限>[,<权限>]...  
ON <对象类型>[,<对象名>]...  
TO <角色>[,<角色>]...
```
##### 3. 将一个角色授予其他的角色或用户
```
GRANT <角色1>[,<角色2>]...  
TO<角色3>[,<用户1>]...  
[WITH ADMIN OPTION]
```
###### 语句说明：  
- WITH ADMIN OPTION说明可以将角色权限继续给其他角色  
- 最终获得的权限是第一行的总和
- 授予者要么是该角色的创建者，要么有角色的ADMIN OPTION  

##### 4. 角色权限的收回
```
REVOKE <权限>[,<权限>]...
ON<对象类型><对象名>
FROM <角色>[,<角色>]... 
```
- 执行者要么是该角色的创建者，要么有角色的ADMIN OPTION  

角色的意义：使用角色来管理数据库权限，可以简化授权的过程，使得自主授权的执行更加灵活方便  

#### 4.2.6 强制存取控制方法
自主存取控制能够通过授权机制有效地控制对敏感数据的读取。但是，这种机制仅仅通过对数据的存取权限来进行安全控制，而对数据本身没有安全性标记。要解决这一问题，就需要对系统控制下的所有主客体实施强制存取控制策略  
强制存取控制：兄同为了保证更高程度的安全性，按照TDI/TDSEC标准中安全策略的要求所采取的强制存取检查手段  
简单定义：每一个数据库对象被标以一定的密级。对于任意一个对象，只有具有合法许可证的的用户才可以存取，强制存取控制因此相对较为严格  
##### 详细说明：  
###### DBMS所管理的全部实体：  
- 主体
    - 是系统中的活动实体，既包括DBMS中所管理的实际用户，也包括代表用户的各个进程
- 客体
    - 是由主体操纵的被动实体，包括文件，基本表，索引，视图等

系统为主体和客体的每一个实例（值）指派了一个**敏感度标记**  
###### 敏感度标记：
- 绝密（TS），机密（S），可信（C），公开（P）  
- 密级的次序：TS>=S>=C>=P  
- 主体的敏感度标记称为许可证级别
- 客体的敏感度标记称为密级
###### 强制存取控制的规则
1. **仅当主体的许可证级别大于等于客体的密级时，该主体才能读取相应的客体**
2. **仅当主题的许可证级别小于等于客体的密级时，该主体才能写相应的客体**

对于规则2的说明：  
**如果违反了规则2，就可能把数据的密级从高流向低，造成数据的泄露**  

总结：**强制存取控制是对数据本身进行密级标记，无论数据如何复制，标记和数据是一个不可分的整体，只有符合密级表级要求的用户才可以操纵数据，从而提供了更高级别的安全性**  
 
若系统的安全性。要求实现强制存取控制，则最终，DBMS的安全机制由自主存取控制和强制存取控制共同构成  

### 4.3 视图机制
1. 通过视图机制可以把要保密的数据对无权存取的用户隐藏起来，从而自动对数据提供一定程度的安全保护  
2. 视图机制可以间接实现支持存取谓词的用户权限定义
（就是在用GRANT语句定义权限时，无法对数据进行条件筛选）   

### 4.4 审计
**审计功能把用户对数据库的所有操作自动记录下来放入审计日志中，审计员可以利用审计日志监控数据库中的各种行为，重现导致数据库现有状况的一系列事件。找出非法存取数据的人、时间、内容等**

##### 1.审计事件
- 服务器事件：审计数据库服务器发生的事件，包括数据库服务器的启动，停止，数据库服务器配置文件的重新加载
- 系统权限：对系统拥有的结构或模式对象进行操作的审计，要求改操作的权限时通过系统权限获得的
- 语句事件：对SQL语句，如DDL，DML, DQL以及DCL的审计
- 模式对象事件：对特定模式对象上进行的SELECT或DML操作的审计。模式对象包括表、视图、存储过程、函数等。模式对象不包括依附于表的索引，约束，触发器，分区表等

（此外，审计事件还包括用户鉴别，自主访问控制，强制访问控制时间）  

##### 2. 审计功能
- 基本功能，提供多种审计查阅方式
- 提供多套审计规则，审计规则一般在数据库初始化设定，以方便审计员管理
- 提供审计分析和报表功能
- 审计日志管理功能。
    - 比如为防止审计员误删记录，将审计日志先转储后删除；对转储的审计记录文件提供完整性和保密性保护等等
- 系统提供提供查询审计设置及审计记录信息的专门视图。对于系统权限级别，语句级别以及模式对象级别的审计记录也可通过相关的系统表直接查看  

##### 3. AUDIT语句和NOAUDIT语句
AUDIT用于设置审计，NOAUDIT用于取消审计功能  
审计分为用户级和系统级：  
- 用户级审计
    - 是任何用户可以设置的审计
    - 主要是用户针对自己创建的数据库表或视图进行审计
    - 记录所有用户对这些表或视图的一切成功和（或）不成功的访问要求以及各种类型的SQL操作
- 系统级审计
    - 只能由数据库管理员设置，用以检测成功或失败的登陆要求，检测授权和收回操作以及其他数据库级权限下的操作

**数据库安全审计系统提供了一种事后检查的安全机制**  

### 4.5 数据加密
加密的基本思想时根据一定的算法将原始数据——明文变换为不可直接识别的格式——密文，从而使得不知道解密算法的人无法获知数据的内容  
数据加密主要包括存储加密和传输加密  
##### 1. 存储加密
- 透明
- 非透明
##### 2. 传输加密
- 链路加密
    - 对传输数据在链路层加密
    - 对于报文和报头均进行加密
- 端到端加密
    - 只加密报文，不加密报头
    - 所需密码设备数量相对较少

SSL：  
实现思路：  
1. 创建可信连接
2. 确认通信双方端点的可靠性
    - 通过数字证书认证完成
3. 协商加密算法和密钥
4. 可信数据传输
5. 关闭可信连接  


### 4.6 其他安全性保护
##### 1. 推理控制
- **用来避免用户利用其能够访问的数据推知更高密级的数据**
-（处理的是强制存取控制没能解决的问题，比如通过列的依赖关系，用户能从低安全等级信息，推导出其无权访问的高安全等级信息）  

##### 2. 隐蔽信道
类似于碰撞攻击，通过UNIQUE列拒绝重复数据，低等级用户不断插入数据

##### 3. 数据隐私
- 控制不愿被他人知道或他人不便知道的个人数据的能力  



